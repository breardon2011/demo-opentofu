allow_draft_prs: true
auto_merge: false
pr_locks: true
telemetry: false
traverse_to_nested_projects: true

projects:
  - name: SHARED
    dir: k8s_deployment
    workflow: terraform
    include_patterns: ["*.tf", "../_env_data/shared.json", "modules/**/*.tf", "modules/**/*.yaml"]
    workspace: shared

  - name: DEV
    dir: k8s_deployment
    workflow: terraform
    include_patterns: ["*.tf", "../_env_data/dev.json", "modules/**/*.tf", "modules/**/*.yaml"]
    workspace: dev

  - name: QA
    dir: k8s_deployment
    workflow: terraform
    include_patterns: ["*.tf", "../_env_data/qa.json", "modules/**/*.tf", "modules/**/*.yaml"]
    workspace: qa

  - name: PROD
    dir: k8s_deployment
    workflow: terraform
    include_patterns: ["*.tf", "../_env_data/prod.json", "modules/**/*.tf", "modules/**/*.yaml"]
    workspace: prod

generate_projects:
  blocks:
    - include: "./terraform/services/**"
      workflow: main

workflows:
  terraform:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
  main:
    plan:
      steps:
        - init
        - plan
    apply:
      steps:
        - init
        - apply
